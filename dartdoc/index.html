
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../pythondoc/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.4">
    
    
      
        <title>Dart Doc - Communicate Trinket M0 Doc</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dart-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Communicate Trinket M0 Doc" class="md-header__button md-logo" aria-label="Communicate Trinket M0 Doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Communicate Trinket M0 Doc
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Dart Doc
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Communicate Trinket M0 Doc" class="md-nav__button md-logo" aria-label="Communicate Trinket M0 Doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Communicate Trinket M0 Doc
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pythondoc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CircuitPython Doc
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Dart Doc
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Dart Doc
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#code-acknowledgement" class="md-nav__link">
    <span class="md-ellipsis">
      Code Acknowledgement
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overall-use" class="md-nav__link">
    <span class="md-ellipsis">
      Overall Use
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bugs-and-possible-improvements" class="md-nav__link">
    <span class="md-ellipsis">
      Bugs and Possible Improvements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dart-code" class="md-nav__link">
    <span class="md-ellipsis">
      Dart code
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dart code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flow-chart" class="md-nav__link">
    <span class="md-ellipsis">
      Flow Chart
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-loops" class="md-nav__link">
    <span class="md-ellipsis">
      Event Loops
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listavailableport" class="md-nav__link">
    <span class="md-ellipsis">
      listAvailablePort
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serialportselect" class="md-nav__link">
    <span class="md-ellipsis">
      serialPortSelect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#printportdescription" class="md-nav__link">
    <span class="md-ellipsis">
      printPortDescription
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stringtouint8list" class="md-nav__link">
    <span class="md-ellipsis">
      stringToUint8List
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#printserialportconfig" class="md-nav__link">
    <span class="md-ellipsis">
      printSerialPortConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdefaultserialportconfig" class="md-nav__link">
    <span class="md-ellipsis">
      setDefaultSerialPortConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#printavailablecommands" class="md-nav__link">
    <span class="md-ellipsis">
      printAvailableCommands()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkismessage" class="md-nav__link">
    <span class="md-ellipsis">
      checkIsMessage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#min" class="md-nav__link">
    <span class="md-ellipsis">
      min
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gettemplatedata" class="md-nav__link">
    <span class="md-ellipsis">
      getTemplateData
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#code-acknowledgement" class="md-nav__link">
    <span class="md-ellipsis">
      Code Acknowledgement
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#overall-use" class="md-nav__link">
    <span class="md-ellipsis">
      Overall Use
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bugs-and-possible-improvements" class="md-nav__link">
    <span class="md-ellipsis">
      Bugs and Possible Improvements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dart-code" class="md-nav__link">
    <span class="md-ellipsis">
      Dart code
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dart code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flow-chart" class="md-nav__link">
    <span class="md-ellipsis">
      Flow Chart
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-loops" class="md-nav__link">
    <span class="md-ellipsis">
      Event Loops
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#listavailableport" class="md-nav__link">
    <span class="md-ellipsis">
      listAvailablePort
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serialportselect" class="md-nav__link">
    <span class="md-ellipsis">
      serialPortSelect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#printportdescription" class="md-nav__link">
    <span class="md-ellipsis">
      printPortDescription
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stringtouint8list" class="md-nav__link">
    <span class="md-ellipsis">
      stringToUint8List
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#printserialportconfig" class="md-nav__link">
    <span class="md-ellipsis">
      printSerialPortConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdefaultserialportconfig" class="md-nav__link">
    <span class="md-ellipsis">
      setDefaultSerialPortConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#printavailablecommands" class="md-nav__link">
    <span class="md-ellipsis">
      printAvailableCommands()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkismessage" class="md-nav__link">
    <span class="md-ellipsis">
      checkIsMessage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#min" class="md-nav__link">
    <span class="md-ellipsis">
      min
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gettemplatedata" class="md-nav__link">
    <span class="md-ellipsis">
      getTemplateData
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<div><h1 id="dart-documentation">Dart Documentation</h1>
<h2 id="code-acknowledgement">Code Acknowledgement</h2>
<p>This code is my original work except for listAvailblePort() function which is from <a href="https://pub.dev/packages/libserialport/example">libserialport documentation example</a>. This code is free to use with proper acknowledgement.</p>
<h2 id="overall-use">Overall Use</h2>
<p>The code functions as a CLI (command line interface) for user to issue commands to the board. It also supports uploading and downloading templates to and from the sensor. The template will be stored in templateBuffer variable which can be later written to a database if this code is to be properly implemented in a Biometric Verification System.</p>
<p>It also lays a foundation for a Android or IOS mobile app to be built on top of it.</p>
<h2 id="bugs-and-possible-improvements">Bugs and Possible Improvements</h2>
<ol>
<li>
<p>The Dart code currently does not handle SerialPortError. In some occassions, the code could throw</p>
<pre><code>    SerialPortError: Bad file descriptor, errno = 9
</code></pre>
</li>
<li>
<p>Download template function currently uses 4096 bytes to store a fingerprint template on the Dart code while the template is actually only 2048 bytes. This is due to the hex representation in String that the code deploy to send and receive data. Ex: 0xF (4 bits) -&gt; 'f' (8 bits). This could be improve but so far the String representation is a working solution for us.</p>
</li>
<li>
<p>Dart's 'reset' command could work when the board's code encounters errors and goes into REPL, but it requires multiple '\n' or ENTER to be sent afterwards in order to move the SerialPortReader to the latest output. This is due to REPL using &gt;&gt;&gt; to prompt the user for input hence incorrectly prompt the Dart code 3 times for input.</p>
</li>
<li>
<p>Dart code currently does not write the templateBuffer to a permanent storage, and it does not have a function to search a database and read a template. Consequently, multiple template download would overwrite one another, and the upload function would only upload the latest template download.</p>
</li>
<li>
<p>'reset' in the middle of code causes '\n' to buffer.</p>
</li>
</ol>
<h2 id="dart-code">Dart code</h2>
<h3 id="flow-chart">Flow Chart</h3>
<figure>
    <img src="../assets/dartflowchart.png" width="1000" height="1000" alt="dart flow chart">
    <figcaption>Dart Flow Chart. Done in <a href="https://learn.adafruit.com/adafruit-trinket-m0-circuitpython-arduino/pinouts">SmartDraw</a> </figcaption>
</figure>

<h3 id="event-loops">Event Loops</h3>
<p>There are 2 event loops in the code.</p>
<p>First one is fingerprintReader Stream. This is the main loop of the program and is shown in the flowchart. This event loop will start when data is sent from the board using print().</p>
<p>The second one is InterruptCheckStream. This is in the process rectangle on the 'Yes' path of 'Is data a certain message' decision block. It is a copy of the stdin stream by setting stdin into a broadcast stream. This stream activates when user types and hits the ENTER key. It will then check whether the input is ESC and send a cancel message to the board to signal stop waiting for fingerprint. <strong>This stream will only start listening when Dart receives <a href="../pythondoc/#status-printing">FINGERREQUEST</a> and pause if Dart receives <a href="../pythondoc/#success-code-printing">OKIMAGE</a>.</strong></p>
<h3 id="api">API</h3>
<p>This section list all the functions in the Dart code.</p>
<h4 id="listavailableport">listAvailablePort</h4>
<pre><code>int listAvailablePort()
</code></pre>
<p>Parameter: None</p>
<p>Return:</p>
<ul>
<li><em>int</em>: Number of detectable serial port</li>
</ul>
<h4 id="serialportselect">serialPortSelect</h4>
<pre><code>int serialPortSelect()
</code></pre>
<p>Parameter: None</p>
<p>Return:</p>
<ul>
<li><em>int</em>: Valid port number selected by user</li>
</ul>
<h4 id="printportdescription">printPortDescription</h4>
<pre><code>void printPortDescription(int portNumber)
</code></pre>
<p>Parameter:</p>
<ul>
<li>portNumber <em>(int)</em>: Port number of port you want to see the description of</li>
</ul>
<p>Return: None</p>
<h4 id="stringtouint8list">stringToUint8List</h4>
<pre><code>Uint8List stringToUint8List(String msg)
</code></pre>
<p>Paramter:</p>
<ul>
<li>msg <em>(String)</em>: Usually user input that needs to be converted in order to send to board</li>
</ul>
<p>Return:</p>
<ul>
<li><em>Uint8List</em>: List that can be sent using [SerialPort object].write()</li>
</ul>
<h4 id="printserialportconfig">printSerialPortConfig</h4>
<pre><code>void printSerialPortConfig(SerialPort port)
</code></pre>
<p>Paramter:</p>
<ul>
<li>port <em>(SerialPort class)</em>: Serial Port object that you want to see the configuration of</li>
</ul>
<p>Return: None</p>
<h4 id="setdefaultserialportconfig">setDefaultSerialPortConfig</h4>
<pre><code>void setDefaultSerialPortConfig(SerialPort port)
</code></pre>
<p>Parameter:</p>
<ul>
<li>port <em>(SerialPort class)</em>: Serial Port object that you want to set the configuration</li>
</ul>
<p>Return: None</p>
<h4 id="printavailablecommands">printAvailableCommands()</h4>
<pre><code>void printAvailableCommands()
</code></pre>
<p>Parameter: None</p>
<p>Return: None</p>
<h4 id="checkismessage">checkIsMessage</h4>
<pre><code>int checkIsMessage(Uint8List data, String message)
</code></pre>
<p>Paramter:</p>
<ul>
<li>
<p>data <em>(Uint8List)</em>: Usually data from fingerprintReader event</p>
</li>
<li>
<p>message <em>(String)</em>: Message that you want to check if it is in the data stream</p>
</li>
</ul>
<p>Return:</p>
<ul>
<li><em>int</em>: The index of the start of the message in the data list. -1 if message is not found</li>
</ul>
<p>Note: the function returns -1 if it matches the first character but not the second one -&gt; message unlikely to exist in this message. This can be removed to avoid false negative.</p>
<h4 id="min">min</h4>
<pre><code>int min(int num1, int num2)
</code></pre>
<p>Parameter:</p>
<ul>
<li>
<p>num1 <em>(int)</em>: A number you want to compare</p>
</li>
<li>
<p>num2 <em>(int)</em>: Another number to compare</p>
</li>
</ul>
<p>Return:</p>
<ul>
<li><em>int</em>: The smaller number</li>
</ul>
<p>Note: This is used to avoid indexing out of range when taking fingerprint template hex data.</p>
<h4 id="gettemplatedata">getTemplateData</h4>
<pre><code>void getTemplateData(Uint8List data, Uint8List templateBuffer, int length)
</code></pre>
<p>Parameter:</p>
<ul>
<li>
<p>data <em>(Uint8List)</em>: data stream from fingerprintReader</p>
</li>
<li>
<p>templateBuffer <em>(Uint8List)</em>: variable to store the fingerprint template</p>
</li>
<li>
<p>length <em>(int)</em>: current length of the buffer that is filled with template data</p>
</li>
</ul>
<p>Return: None</p>
<p>Note: This function copy data to templateBuffer</p></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.c011b7c0.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.7389ff0e.min.js"></script>
      
    
  </body>
</html>